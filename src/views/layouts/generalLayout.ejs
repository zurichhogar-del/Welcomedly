<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="icon" href="/images/logo_enc.svg" type="images/svg">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- CSRF Token -->
    <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
    <meta name="csrf-token" content="<%= csrfToken %>">
    <% } %>

    <title>Welcomdly!</title>
</head>

<body>

    <%- include ('../partials/generalHeader') %>

<div id="gestion" class="d-flex justify-content-around">

    <%- include ('../partials/generalCard') %>

<!--------------------------------aca termina la barra inferior y empieza el container donde va cada pagina por aparte------------------------------------------------>
<main class="mt-3 col-md-8">
    <%- body %>
</main>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<% if (swalError) { %>
<script>
    Swal.fire({
        icon: 'error',
        title: 'Error',
        text: "<%= swalError %>"
    });
</script>
<% } %>

<% if (mensajeExito) { %>
<script>
    Swal.fire({
        icon: 'success',
        title: 'Éxito',
        text: "<%= mensajeExito %>"
    });
</script>
<% } %>

<!-- CSRF Helper -->
<script type="module" src="/js/csrfHelper.js"></script>
<script>
    // Inicializar protección CSRF cuando el DOM esté listo
    document.addEventListener('DOMContentLoaded', function() {
        // Importar y ejecutar initCSRFProtection
        import('/js/csrfHelper.js').then(module => {
            module.initCSRFProtection();
        }).catch(err => {
            console.warn('No se pudo cargar el helper CSRF:', err);
        });
    });
</script>

</body>
</html>